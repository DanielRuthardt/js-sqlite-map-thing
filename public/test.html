<html>
	<head>
		<title>ok hi</title>
		<link rel="stylesheet" href="i.css" type="text/css" media="screen" /> 
		<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.5.2.min.js" type="text/javascript"></script>
		<script src="plist.js" type="text/javascript"></script>
		<script src="sql.js" type="text/javascript"></script>
		<script src="pack.js" type="text/javascript"></script>
		<!--<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAACxmoCW9SCCej9E7k_D1pRBS7VR8MD1GvGPhRm2O6ZBoEGcntTBSl5BN1Xd0Kf04AKAe14dQ-3BYZ4Q" type="text/javascript"></script>-->
		 <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
	</head>
		<div id="selector">
			<input type="file" webkitdirectory directory multiple mozdirectory id="fileselector"> 
			<div id="drop_zone" style="height: 80px; width: 100%; border: 4px #ddd dashed;">Drop files here</div>
		</div>
		<div id="map_canvas" style="width: 100%; height: 500px"></div>
		<!-- (MCC INTEGER, MNC INTEGER, LAC INTEGER, CI INTEGER, Timestamp FLOAT, Latitude FLOAT, Longitude FLOAT, HorizontalAccuracy FLOAT, Altitude FLOAT, VerticalAccuracy FLOAT, Speed FLOAT, Course FLOAT, Confidence INTEGER -->
		<table>
			<thead>
				<tr>
					<th>MCC</th><th>MNC</th><th>LAC</th><th>CI</th><th>Timestamp</th>
					<th>Latitude</th><th>Longitude</th><th>HorizontalAccuracy</th>
					<th>Altitude</th><th>VerticalAccuracy</th>
					<th>Course</th><th>Confidence</th>
				</tr>
			</thead>
			<tbody>
			
			</tbody>
		</table>
		<ul id="list"></ul>
	<body>
		
	<script type="text/javascript">
	$(function(){ 
	   var latlng = new google.maps.LatLng(50, -50);
	    var myOptions = {
	      zoom: 3,
	      center: latlng,
	      mapTypeId: google.maps.MapTypeId.ROADMAP
	    };
	    GOOG_map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);    
	})
	
	$.strPad = function(i,l,s) {
		var o = i.toString();
		if (!s) { s = '0'; }
		while (o.length < l) {
			o = s + o;
		}
		return o;
	};
	
	SQR = new Sqlite3Reader();
	PACK = new JSPack();
	
	$('#fileselector').change(function(e) {
		i = this.files;
		handleFileSelect(i)
	});
	
	$(document).bind('sqlready', function(e) {
		data = SQR.read_table('CellLocationLocal');
		$.each(data, function(i,row) { 
			var myLatLng = new google.maps.LatLng(row[5], row[6]);
			var image = 'beachflag.png';
			var beachMarker = new google.maps.Marker({
		      position: myLatLng,
		      map: GOOG_map
		  });
			//console.log(row)
			var cells = $.map(row, function(cell) { return '<td>' + cell + '</td>' }).join('');
			
			var r = $('<tr>').html(cells);
			$('tbody').append(r)

		})
	})
	
	function handleFileDrop(evt) {
	    evt.stopPropagation();
	    evt.preventDefault();

	    var files = evt.dataTransfer.files; // FileList object.
		console.log(files)
		handleFileSelect(files);
	  }
	
	
	function handleDragOver(evt) {
		evt.stopPropagation();
		evt.preventDefault();
	}
	var dropZone = document.getElementById('drop_zone');
	dropZone.addEventListener('dragover', handleDragOver, false);
 	dropZone.addEventListener('drop', handleFileDrop, false);
	
	function handleFileSelect(input) {
	    var files = []
	    for(var i = 0, f; f = input[i]; i++) {
	        files[f.name] = f;
		}
	    if(("Manifest.mbdb" in files) && ("Manifest.mbdx" in files)) {
	        lilog('manifest found')
	        var mbdb = new FileReader();
	        mbdb.onload = load_mbdb(mbdb, files);
			mbdb.onerror = function(e) { alert(e) }
	        mbdb.readAsBinaryString(files["Manifest.mbdb"]);
	    } else {
	    	lilog('no manifest found!');
	    }
	}
	

	
	function lilog(t) {
		$('#list').append($('<li />', {text: t}));
	}
	</script>
	</body>
</html>